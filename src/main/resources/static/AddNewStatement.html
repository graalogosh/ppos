<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Приём заявлений</title>

    <!--- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/AddNewStatement.css" rel="stylesheet">
    <link href="css/jquery.dataTables.css" rel="stylesheet">

    <!--- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!---[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
     
  </head>
  <body>
  
  <!-- Выпадающее "Меню" -->
  <div class="container">
      <div class="row">
          <div class="navbar navbar-inverse">
              <div class="conteiner">
                  <div class="collapse navbar-collapse">
                      <ul class="nav navbar-nav">
                          <li class="dropdown">
                             <a href="#" class="dropdown-toggle" data-toggle="dropdown">Меню <b class="caret"></b></a>
                              <ul class="dropdown-menu">
                                  <li><a href="main.html">Все студенты</a></li>
                                  <li><a href="documentationshow.html">Студенты без документов</a></li>
                                  <li><a href="statementstatistic.html">Статистика по заявлениям</a></li>
                                  <li><a href="socialscholarshipstatistic.html">Социальная стипендия</a></li>
                                  <li><a href="printlist.html">Печать ведомостей</a></li>
                                  <li><a href="competition.html">Конкурсный отбор</li>
                                  <li><a href="edinovremstatistic.html">Статистика по единовременной поддержке</a></li>
                                  <li><a href="accountingfees.html">Учёт взносов</a></li>
                                  <li><a href="adminsettingsform.html">Настройки</a></li>
                              </ul>
                          </li>
                      </ul>
                  </div>
              </div>
          </div>
      </div>
  </div>
  <!-- Конец выпадающего "Меню" -->
  
  
   <div class="container">
       <div class="panel panel-default">
           <div class="panel-heading">
               Студент
           </div>
           <ul class="list-group">
              <li class="list-group-item">
                  <div class="row">
                     <!-- номер студенческого и группа -->
                      <form class="form-horizontal col-md-4 col-lg-4">
                         <!-- номер студенческого -->
                          <div class="form-group">
                              <label class="control-label col-md-6 col-lg-6" for="studentID">№ студенческого:</label>
                              <div class="col-md-6 col-lg-6">
                                  <input type="text" class="form-control" id="studentID">
                              </div>
                          </div>
                          <!-- конец номера студенческого -->
                          
                          <!-- группа -->
                          <div class="form-group">
                              <label class="control-label col-md-6 col-lg-6" for="educationalGroup">Группа:</label>
                              <div class="col-md-6 col-lg-6">
                                  <input type="text" class="form-control" id="educationalGroup" disabled>
                              </div>
                          </div>
                          <!-- конец руппы -->
                      </form>
                      <!-- конец блока с номером студенческого и группы -->
                      
                      <!-- номер телефона и банковского счёта -->
                      <form class="form-horizontal col-md-5 col-lg-5">
                          <!-- номер телефона -->
                          <div class="form-group">
                              <label class="control-label col-md-4 col-lg-3" for="phone">Телефон:</label>
                              <div class="col-md-8 col-lg-9">
                                  <input type="tel" class="form-control" id="phone" disabled>
                              </div>
                          </div>
                          <!-- конец номера телефона -->
                          
                          <!-- банковский счёт -->
                          <div class="form-group">
                              <label class="control-label col-md-4 col-lg-3" for="bankAccountNumber">Банк. счёт:</label>
                              <div class="col-md-8 col-lg-9">
                                  <input type="text" class="form-control" id="bankAccountNumber" disabled>
                              </div>
                          </div>
                          <!-- конец банковского счёта -->
                      </form>
                      <!-- конец блока с номером телефона и банковского счёта <-->
                      
                      <!-- кнопки "Найти" и "Открыть карточку студента" -->
                      <form class="form-horizontal col-md-3 col-lg-3 pull-right">
                          <div class="btn-group-vertical visible-md visible-lg" role="group">
                              <button type="button" class="btn btn-success" onclick="onClickFind()">Найти</button>
                              <button type="button" class="btn btn-primary" onclick="onClickOpenStudent()">Открыть карточку студента</button>
                          </div>
                          <div class="btn-group visible-sm visible-xs" role="group">
                              <button type="button" class="btn btn-success" onclick="onClickFind()">Найти</button>
                              <button type="button" class="btn btn-primary" onclick="onClickOpenStudent()">Открыть карточку студента</button>
                          </div>   
                      </form>
                      <!-- конец блока с кнопками "Найти" и "Открыть карточку студента" -->
                  </div>
                  <div class="row">
                    <form class="form-horizontal col-md-12 col-lg-12">
                      <div class="form-group">
                        <label class="control-label col-md-1 col-lg-1" for="fio">Ф.И.О.:</label>
                        <div class="col-md-11 col-lg-11">
                          <input type="text" class="form-control" id="fio" disabled>
                        </div>
                      </div>
                    </form>
                  </div>
               </li>
               <li class="list-group-item">
                   <div class="row">
                       <form class="form-horizontal col-md-6 col-lg-6">
                           <!-- раздел -->
                           <div class="form-group">
                               <label class="control-label col-lg-2" for="sectionID">Раздел:</label>
                                  <div class="col-lg-10">
                                   <select class="form-control" id="sectionID" onchange="onChangeSection()" disabled>
                                    <option value="0" disabled selected style="display:none;">Выберите раздел</option>
                                   </select>
                                 </div>
                           </div>
                           <!-- конец раздела -->
                           </form>
                           
                        <form class="form-horizontal col-md-6 col-lg-6">
                           <!-- мероприятие -->
                           <div class="form-group">
                               <label class="control-label col-lg-3" for="eventID">Мероприятие:</label>
                               <div class="col-lg-9">
                                 <select class="form-control" id="eventID" onchange="onChangeEvent()" disabled>
                                  <option value="0" disabled selected style="display:none;">Выберите мероприятие</option>
                                 </select>
                               </div>
                           </div>
                           <!-- конец мероприятия -->
                       </form>
                   </div>
               </li>
           </ul>
           <div class="panel-heading">
               Общественная работа
           </div>
           <ul class="list-group">
               <li class="list-group-item">
                   <div class="row">
                       <form class="form-horizontal col-md-6 col-lg-6">                           
                           <!-- категория -->
                           <div class="form-group">
                               <label class="control-label col-lg-3" for="socialWorkCategory">Категория:</label>
                                  <div class="col-lg-9">
                                     <select class="form-control" id="socialWorkCategory" disabled>
                                        <option value="0" disabled selected style="display:none;">Выберите категорию</option>
                                      </select>
                                  </div>
                           </div>
                           <!-- конец категории -->
                           </form>
                           
                        <form class="form-horizontal col-md-6 col-lg-6">
                           <!-- общественная работа -->
                           <div class="form-group">
                               <label class="control-label col-lg-3" for="socialWork">Общ. работа:</label>
                               <div class="col-lg-9">
                                 <select class="form-control" id="socialWork" disabled>
                                    <option value="0" disabled selected style="display:none;">Выберите общественную работу</option>
                                 </select>
                               </div>
                           </div>
                           <!-- конец общественной работы -->
                       </form>
                   </div>
               </li>
           </ul>
           <div class="panel-heading">
               Социальный статус
           </div>
           <ul class="list-group">
               <li class="list-group-item">                   
                   <div class="row">
                       <form class="form-horizontal col-md-6 col-lg-6">
                           <div class="form-group">
                               <label class="control-label col-lg-5" for="socialCategory">Социальная категория:</label>
                               <div class="col-lg-7">
                                 <select class="form-control" id="socialCategory" disabled>
                                    <option value="0" disabled selected style="display:none;">Выберите социальную категорию</option>
                                 </select>
                               </div>
                           </div>
                           <label class="checkbox-inline"><input type="checkbox" id="completeDocs" disabled>Все документы в наличии</label>
                           <label class="checkbox-inline"><input type="checkbox" id="socialGrant" disabled>Социальная стипендия</label>
                       </form>
                       <div class="form-horizontal col-md-6 col-lg-6">
                           <div class="form-group col-sm-4 col-md-6 col-lg-6">
                               <label for="documents">Необходимые документы:</label>
                               <p><textarea id="documents" disabled></textarea></p>
                           </div>
                           <div class="form-group col-sm-4 col-md-6 col-lg-6">
                               <label for="comment">Комментарий:</label>
                               <p><textarea id="comment" disabled></textarea></p>
                           </div>
                       </div>
                   </div>
               </li>
           </ul>
           <div class="panel-heading">
               Дополнительные параметры
           </div>
           <ul class="list-group">
               <li class="list-group-item" disabled>
                   <div class="row">
                         <form class="form-horizontal col-md-4 col-lg-4">
                             <div class="form-group">
                                 <label class="control-label col-lg-3" for="score">Оценки:</label>
                                 <div class="col-lg-9">
                                   <div class="input-group">
                                       <input type="text" class="form-control" id="score" disabled>
                                       <span class="input-group-btn">
                                       <button class="btn btn-default" type="button" id="calculateButton" onclick="onClickСalculate()" disabled>Рассчитать</button>
                                       </span>
                                   </div> 
                                 </div>                                  
                             </div>
                         </form>
                             <form class="form-horizontal col-md-4 col-lg-3">
                               <div class="form-group">
                                   <label class="control-label col-lg-6" for="average_score">Средний балл:</label>
                                   <div class="col-lg-6">
                                     <input type="text" class="form-control" id="average_score" disabled>
                                   </div>                      
                               </div>
                             </form>
                             <form class="form-horizontal col-md-4 col-lg-2">
                               <div class="form-group">
                                   <label class="control-label col-lg-4" for="moneyCategory">Сумма:</label>
                                   <div class="col-lg-8">
                                     <input type="text" class="form-control" id="moneyCategory" disabled>
                                   </div>
                               </div>
                             </form>
                             <form class="form-horizontal col-lg-3">
                               <div class="btn-group pull-right">
                                   <button type="submit" class="btn btn-success" id="addButton" disabled>Добавить</button>
                                   <button type="submit" class="btn btn-primary">Отмена</button>
                               </div>
                             </form>
                         </form>
                   </div>
               </li>
           </ul>
       </div>
   </div>
    


    <!-- Подключаемые скрипты -->
    <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="js/jquery.dataTables.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/jquery.mask.min.js"></script>
    <script type="text/javascript" src="js/function_sendInform.js"></script>
    <script type="text/javascript" src="js/function_averageEstimates.js"></script>


<!-- ____________________________________________________________________________________________________ -->


   <!-- глабальные переменные -->
    <script>
      //переменная для обозначения, попадает заявление в резерв или нет
      var reserve = false;
    </script>
<!-- ____________________________________________________________________________________________________ -->


    <!-- Когда документ загрузится - запрашиваем данные о разделах мероприятий и записываем их в элемент sectionID -->
    <script>
      $(document).ready(function() {
        //маска для ввода оценок студента
        $('#score').mask('0000000000', {'translation': {0: {pattern: /[2-5]/}}});
        //маска для номера студенческого
        $('#studentNumber').mask('00000000', {'translation': {0: {pattern: /[0-9Ии-]/}}});

        //запрашиваем данные о разделах мероприятий и записываем их в элемент sectionID
        $.getJSON('https://graalogosh.tk/section', function(data) {
            $.each(data, function(index, el) {
              $('<option value="' + el.sectionID + '">' + el.title + '</option>').appendTo("#sectionID");
            });
        });
      });
    </script>


<!-- ____________________________________________________________________________________________________ -->


    <!-- Поиск студента по номеру студенческого при нажатии на кнопку "Найти" и вывод информации о нём,
         активация комбобокса раздела мероприятия и checkbox "Все документы в наличии" -->
    <script>
      function onClickFind () {

        //Если воле номера студенческого не заполнили, то выводим об этом сообщение с предупреждением и завершаем скрипт
        if ($('#studentID').val() == "") {
          alert ("Не введён номер студенческого.");
          return;
        }

        var query_data = sendInform("studentID");

        $.getJSON('https://graalogosh.tk/student', query_data, function(data) {
            $.each(data, function(index, el) {
              $("#educationalGroup").val(el.educationalGroup);
              $("#phone").val(el.phone);
              $("#bankAccountNumber").val(el.bankAccountNumber);
              $("#fio").val(el.name);
            });
        });

        //активация комбобокса раздела мероприятия и checkbox "Все документы в наличии"
        $('#sectionID').prop('disabled', false);
        $('#completeDocs').prop('disabled', false)
      }
    </script> 


<!-- ____________________________________________________________________________________________________ -->


    <!-- Рассчитывание средней оценки студента и запись в value элемента c id=calculateButton -->
    <script>
	    function onClickСalculate() {
        //сли не было введено ни одно число - выводим об этом сообщение и прекращаем вычисление среднего значения
        if ($('#score').val() == '') {
          alert('Не введена ни одна оценка.');
        }
        else {
          $("#average_score").val(averageEstimates("score"));
        }
	    }
    </script>


<!-- ____________________________________________________________________________________________________ -->


		<!-- Заполняем поле eventID мероприятиями по выбранному разделу мероприятий-->
		<script>
			function onChangeSection() {

        //удаляем уже записанные в комбобокс мероприятия
        $('#eventID').html('<option value="0" disabled selected style="display:none;">Выберите мероприятие</option>');

        //Заполняем поле eventID мероприятиями по выбранному разделу мероприятий
        var query_data = sendInform("sectionID");

				$.getJSON('https://graalogosh.tk/event', query_data, function(data) {
						$.each(data, function(index, el) {
							 $('<option value="' + el.eventID + '">' + el.title + '</option>').appendTo('#eventID');
						});
				});

        //активация комбобокса мероприятий и раздела с комментарием
        $('#eventID').prop('disabled', false);
        $('#comment').prop('disabled', false);

        });
			}
		</script>


<!-- ____________________________________________________________________________________________________ -->


    <!-- при выборе мероприятия проверяем, не подавал ли студент заявление на него в этом семестре и не ездил ли на него вообще за всё время обучения,
         активируем кнопку добавления заявления -->
    <script>
        function onChangeEvent() {

          //сбрасываем флаг попадания заявления в резерв
          reserve = false;

          var query_data = sendInform("studentID", "eventID");

          //проверяем, подавал ли студент заявление по данному разделу в текущем семестре
          $.getJSON('https://graalogosh.tk/statement/check/beenOnSectionInCurTerm', query_data, function(data) {
            //если получили true - студент автматически попадает в резерв
            if (data == true) {
              reserve = true;
              alert('Студент уже подавал заявление по данному разделу. При подаче ещё одного заявления оно автоматически попадёт в резерв.');
            }
          });

          //проверяем, подавал ли студент заявление на данное мероприятие в текущем семестре
          $.getJSON('https://graalogosh.tk/statement/check/madeStetementOnEvent', query_data, function(data) {

              //если нашлись заявления, удовлетворяющие условиям, блокируем добавление и сообщеам, что документы уже были добавлены
              if (data == true) {
                //деактивируем кнопку "Добавить""
                $('#addButton').prop('disabled', true);

                //выводим сообщение о том, что студент уже подавал документы на данное мероприятие в текущем семестре
                alert('Нельзя принять документы. Студент уже подавал заявление на выбранное мероприятие в текущем семестре.');

                return;
              }
              //если заявлений, удовлетворяющих условиям нет, разблокируем кнопку "Добавить"
              else {
                $('#addButton').prop('disabled', false);
              }
          });

          //проверяем, ездил ли студент на данное мероприятие за всё время обучения (по предкам мероприятия)
          $.getJSON('https://graalogosh.tk/statement/check/beenOnAncestors', query_data, function(data) {
            //если true, то предупреждаем, что заявление автоматически попадает в резерв
            if (data == true) {
              reserve = true;
              alert("Студент уже ездил на данное мероприятие раньше. Его заявление автоматически попадёт в резерв.");
            }
          });

          var query_data = sendInform("sectionID");
          //активирование нужных и деактивирование ненужных для выбранного раздела элементов
          $.getJSON('https://graalogosh.tk/section', query_data, function(data) {
              $.each(data, function(index, el) {
                 $('#socialGrant').prop('disabled', !el.socialGrant);
                 $('#socialCategory').prop('disabled', !el.socialCategory);
                 $('#socialWorkCategory').prop('disabled', !el.socialWork);
                 $('#socialWork').prop('disabled', !el.socialWork);
                 $('#score').prop('disabled', !el.averageScore);
                 $('#calculateButton').prop('disabled', !el.averageScore);
                 $('#bankAccountNumber').prop('disabled', !el.bankAccountNumber);
              });
          });
        }
    </script>


<!-- ____________________________________________________________________________________________________ -->

  
    <!-- Перенаправление не страницу с карточкой студента при нажатии кнопки "Открыть карточку студента" -->
    <script>
      function onClickOpenStudent() {
        window.location.href = "https://graalogosh.tk/statements?statementID=" + $('#studentID').val();
      }
    </script>


  </body>
</html>