<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Приём заявлений</title>

    <!--- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/AddNewStatement.css" rel="stylesheet">
    <link href="css/jquery.dataTables.css" rel="stylesheet">

    <!--- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!---[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
     
  </head>
  <body>
  
  <!-- Выпадающее "Меню" -->
  <div class="container">
      <div class="row">
          <div class="navbar navbar-inverse">
              <div class="conteiner">
                  <div class="collapse navbar-collapse">
                      <ul class="nav navbar-nav">
                          <li class="dropdown">
                             <a href="#" class="dropdown-toggle" data-toggle="dropdown">Меню <b class="caret"></b></a>
                              <ul class="dropdown-menu">
                                  <li><a href="main.html">Все студенты</a></li>
                                  <li><a href="documentationshow.html">Студенты без документов</a></li>
                                  <li><a href="statementstatistic.html">Статистика по заявлениям</a></li>
                                  <li><a href="socialscholarshipstatistic.html">Социальная стипендия</a></li>
                                  <li><a href="printlist.html">Печать ведомостей</a></li>
                                  <li><a href="competition.html">Конкурсный отбор</li>
                                  <li><a href="edinovremstatistic.html">Статистика по единовременной поддержке</a></li>
                                  <li><a href="accountingfees.html">Учёт взносов</a></li>
                                  <li><a href="adminsettingsform.html">Настройки</a></li>
                              </ul>
                          </li>
                      </ul>
                  </div>
              </div>
          </div>
      </div>
  </div>
  <!-- Конец выпадающего "Меню" -->
  
  
   <div class="container">
       <div class="panel panel-default">
           <div class="panel-heading">
               Студент
           </div>
           <ul class="list-group">
              <li class="list-group-item">
                  <div class="row">
                     <!-- номер студенческого и группа -->
                      <form class="form-horizontal col-md-4 col-lg-4">
                         <!-- номер студенческого -->
                          <div class="form-group">
                              <label class="control-label col-md-6 col-lg-6" for="studentID">№ студенческого:</label>
                              <div class="col-md-6 col-lg-6">
                                  <input type="text" class="form-control" id="studentID">
                              </div>
                          </div>
                          <!-- конец номера студенческого -->
                          
                          <!-- группа -->
                          <div class="form-group">
                              <label class="control-label col-md-6 col-lg-6" for="educationalGroup">Группа:</label>
                              <div class="col-md-6 col-lg-6">
                                  <input type="text" class="form-control" id="educationalGroup" disabled>
                              </div>
                          </div>
                          <!-- конец руппы -->
                      </form>
                      <!-- конец блока с номером студенческого и группы -->
                      
                      <!-- номер телефона и банковского счёта -->
                      <form class="form-horizontal col-md-5 col-lg-5">
                          <!-- номер телефона -->
                          <div class="form-group">
                              <label class="control-label col-md-4 col-lg-3" for="phone">Телефон:</label>
                              <div class="col-md-8 col-lg-9">
                                  <input type="tel" class="form-control" id="phone" disabled>
                              </div>
                          </div>
                          <!-- конец номера телефона -->
                          
                          <!-- банковский счёт -->
                          <div class="form-group">
                              <label class="control-label col-md-4 col-lg-3" for="bankAccountNumber">Банк. счёт:</label>
                              <div class="col-md-8 col-lg-9">
                                  <input type="text" class="form-control" id="bankAccountNumber" onblur="onBlurBankAccountNumber()" disabled>
                              </div>
                          </div>
                          <!-- конец банковского счёта -->
                      </form>
                      <!-- конец блока с номером телефона и банковского счёта <-->
                      
                      <!-- кнопки "Найти" и "Открыть карточку студента" -->
                      <form class="form-horizontal col-md-3 col-lg-3 pull-right">
                          <div class="btn-group-vertical visible-md visible-lg" role="group">
                              <button type="button" class="btn btn-success" onclick="onClickFind()">Найти</button>
                              <button type="button" class="btn btn-primary" onclick="onClickOpenStudent()">Открыть карточку студента</button>
                          </div>
                          <div class="btn-group visible-sm visible-xs" role="group">
                              <button type="button" class="btn btn-success" onclick="onClickFind()">Найти</button>
                              <button type="button" class="btn btn-primary" onclick="onClickOpenStudent()">Открыть карточку студента</button>
                          </div>   
                      </form>
                      <!-- конец блока с кнопками "Найти" и "Открыть карточку студента" -->
                  </div>
                  <div class="row">
                    <form class="form-horizontal col-md-12 col-lg-12">
                      <div class="form-group">
                        <label class="control-label col-md-1 col-lg-1" for="fio">Ф.И.О.:</label>
                        <div class="col-md-11 col-lg-11">
                          <input type="text" class="form-control" id="fio" disabled>
                        </div>
                      </div>
                    </form>
                  </div>
               </li>
               <li class="list-group-item">
                   <div class="row">
                       <form class="form-horizontal col-md-6 col-lg-6">
                           <!-- раздел -->
                           <div class="form-group">
                               <label class="control-label col-lg-2" for="sectionID">Раздел:</label>
                                  <div class="col-lg-10">
                                   <select class="form-control" id="sectionID" onchange="onChangeSection()" disabled>
                                    <option value="0" disabled selected style="display:none;">Выберите раздел</option>
                                   </select>
                                 </div>
                           </div>
                           <!-- конец раздела -->
                           </form>
                           
                        <form class="form-horizontal col-md-6 col-lg-6">
                           <!-- мероприятие -->
                           <div class="form-group">
                               <label class="control-label col-lg-3" for="eventID">Мероприятие:</label>
                               <div class="col-lg-9">
                                 <select class="form-control" id="eventID" onchange="onChangeEvent()" disabled>
                                  <option value="0" disabled selected style="display:none;">Выберите мероприятие</option>
                                 </select>
                               </div>
                           </div>
                           <!-- конец мероприятия -->
                       </form>
                   </div>
               </li>
           </ul>
           <div class="panel-heading">
               Общественная работа
           </div>
           <ul class="list-group">
               <li class="list-group-item">
                   <div class="row">
                       <form class="form-horizontal col-md-6 col-lg-6">                           
                           <!-- категория -->
                           <div class="form-group">
                               <label class="control-label col-lg-3" for="socialWorkCategoryID">Категория:</label>
                                  <div class="col-lg-9">
                                     <select class="form-control" id="socialWorkCategoryID" onchange="onChangeSocialWorkCategory()" disabled>
                                        <option value="0" disabled selected style="display:none;">Выберите категорию</option>
                                      </select>
                                  </div>
                           </div>
                           <!-- конец категории -->
                           </form>
                           
                        <form class="form-horizontal col-md-6 col-lg-6">
                           <!-- общественная работа -->
                           <div class="form-group">
                               <label class="control-label col-lg-3" for="socialWorkID">Общ. работа:</label>
                               <div class="col-lg-9">
                                 <select class="form-control" id="socialWorkID" disabled onchange="onChangeSocialWork()">
                                    <option value="0" disabled selected style="display:none;">Выберите общественную работу</option>
                                 </select>
                               </div>
                           </div>
                           <!-- конец общественной работы -->
                       </form>
                   </div>
               </li>
           </ul>
           <div class="panel-heading">
               Социальный статус
           </div>
           <ul class="list-group">
               <li class="list-group-item">                   
                   <div class="row">
                       <form class="form-horizontal col-md-6 col-lg-6">
                           <div class="form-group">
                               <label class="control-label col-lg-5" for="socialCategoryID">Социальная категория:</label>
                               <div class="col-lg-7">
                                 <select class="form-control" id="socialCategoryID" onchange="onChangeSocialCategory()" disabled>
                                    <option value="0" disabled selected style="display:none;">Выберите социальную категорию</option>
                                 </select>
                               </div>
                           </div>
                           <label class="checkbox-inline"><input type="checkbox" id="completeDocs" disabled>Все документы в наличии</label>
                           <label class="checkbox-inline"><input type="checkbox" id="socialGrant" disabled>Социальная стипендия</label>
                       </form>
                       <div class="form-horizontal col-md-6 col-lg-6">
                           <div class="form-group col-sm-4 col-md-6 col-lg-6">
                               <label for="documents">Необходимые документы:</label>
                               <p><textarea id="documents" disabled></textarea></p>
                           </div>
                           <div class="form-group col-sm-4 col-md-6 col-lg-6">
                               <label for="comment">Комментарий:</label>
                               <p><textarea id="comment" disabled></textarea></p>
                           </div>
                       </div>
                   </div>
               </li>
           </ul>
           <div class="panel-heading">
               Дополнительные параметры
           </div>
           <ul class="list-group">
               <li class="list-group-item" disabled>
                   <div class="row">
                         <form class="form-horizontal col-md-4 col-lg-4">
                             <div class="form-group">
                                 <label class="control-label col-lg-3" for="score">Оценки:</label>
                                 <div class="col-lg-9">
                                   <div class="input-group">
                                       <input type="text" class="form-control" id="score" disabled>
                                       <span class="input-group-btn">
                                       <button class="btn btn-default" type="button" id="calculateButton" onclick="onClickСalculate()" disabled>Рассчитать</button>
                                       </span>
                                   </div> 
                                 </div>                                  
                             </div>
                         </form>
                             <form class="form-horizontal col-md-4 col-lg-3">
                               <div class="form-group">
                                   <label class="control-label col-lg-6" for="averageScore">Средний балл:</label>
                                   <div class="col-lg-6">
                                     <input type="text" class="form-control" id="averageScore" disabled>
                                   </div>                      
                               </div>
                             </form>
                             <form class="form-horizontal col-md-4 col-lg-2">
                               <div class="form-group">
                                   <label class="control-label col-lg-4" for="moneyCategory">Сумма:</label>
                                   <div class="col-lg-8">
                                     <input type="text" class="form-control" id="moneyCategory" disabled>
                                   </div>
                               </div>
                             </form>
                             <form class="form-horizontal col-lg-3">
                               <div class="btn-group pull-right">
                                   <button type="button" class="btn btn-success" id="addButton" onclick="onClickAddButton()" disabled>Добавить</button>
                                   <button type="submit" class="btn btn-primary">Отмена</button>
                               </div>
                             </form>
                         </form>
                   </div>
               </li>
           </ul>
       </div>
   </div>
    


    <!-- Подключаемые скрипты -->
    <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="js/jquery.dataTables.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/jquery.mask.min.js"></script>
    <script type="text/javascript" src="js/function_sendInform.js"></script>
    <script type="text/javascript" src="js/function_averageEstimates.js"></script>
    <script type="text/javascript" src="js/function_changeSettings.js"></script>


<!-- ____________________________________________________________________________________________________ -->


   <!-- глабальные переменные -->
    <script>
      //переменная для обозначения, попадает заявление в резерв или нет
      var reserve = false;
      //объект для проверки заполненности всех нужных полей перед добавлением заявления
      var addObject = {};
      //переменная для хранения номера заявления (если заявление - то null, если не новое - то его номер из базы данных)
      var statementID = null;
    </script>
<!-- ____________________________________________________________________________________________________ -->


    <!-- Когда документ загрузится - задаём маски ввода элементам и парсим входящую строку запроса, если таковая была (получаем номер открытого заявления) -->
    <script>
      $(document).ready(function() {
        //маска для ввода оценок студента
        $('#score').mask('0000000000', {'translation': {0: {pattern: /[2-5]/}}});
        //маска для номера студенческого
        $('#studentID').mask('00000000', {'translation': {0: {pattern: /[0-9Ии-]/}}});
        //маска для номера банковского счёта
        $('#bankAccountNumber').mask('00000000000000000000');

        //парсим строку запроса (получаем номер открытого заявления и находится ли оно в резерве)
        var index = window.location.search.indexOf('&')
        reserve = window.location.search.substring(9, index);
        statementID = window.location.search.substring(index+13);

        if (reserve == 'true') {
          reserve = true;
        }
        else {
          reserve = false;
        }

        //проверка, был ли передан номер заявления. Если нет - мы работаем в режиме добавления заявления и прерываем работу этой функции
        if (statementID == "") {
          return;
        };

        //запрашиваем данные по открытому заявлению и заполняем поля данными о нём
        var query_data = {"statementID": statementID};

        $.getJSON('/statement', query_data , function(data) {
            $.each(data, function(index, el) {
              $("#studentID").val(el.student.studentID);
              $("#educationalGroup").val(el.student.educationalGroup);
              $("#phone").val(el.student.phone);
              $("#bankAccountNumber").val(el.student.bankAccountNumber);
              $("#fio").val(el.student.name);

              // отключаем асинхронность запросов, чтобы виды разделов успели загрузиться до того, как мы выберем в них раздел текущего заявления
              $.ajaxSetup({async:false});

              //запрашиваем данные о разделах мероприятий и записываем их в элемент sectionID
              $.getJSON('/section', function(data) {
                  $.each(data, function(index, el) {
                    $('<option value="' + el.sectionID + '">' + el.title + '</option>').appendTo("#sectionID");
                  });
              });

              $("#sectionID").val(el.event.section.sectionID);

              //активация комбобокса раздела мероприятия и checkbox "Все документы в наличии"
              changeSettings("sectionID", "disabled", false, "completeDocs", "disabled", false);
            });
          });

      });
    </script>


<!-- ____________________________________________________________________________________________________ -->


    <!-- Поиск студента по номеру студенческого при нажатии на кнопку "Найти" и вывод информации о нём,
         активация комбобокса раздела мероприятия и checkbox "Все документы в наличии" -->
    <script>
      function onClickFind () {
        //выключаем все элементы при поиске студента(в дальнейшей работе с программой нужные элементы будут включены)
        changeSettings("socialGrant", 'disabled', true,
          "socialCategoryID", 'disabled', true,
          "socialWorkCategoryID", 'disabled', true,
          "socialWorkID", 'disabled', true,
          "score",'disabled', true,
          "calculateButton", 'disabled', true,
          "bankAccountNumber", 'disabled', true,
          "eventID", "disabled", true,
          "comment", "disabled", true);

        //очищаем все поля ввода, чтобы пользователь случайно не добавил заявление с неверными данными
        $('#sectionID').html('<option value="0" disabled selected style="display:none;">Выберите раздел</option>');
        $('#eventID').html('<option value="0" disabled selected style="display:none;">Выберите мероприятие</option>');
        $('#socialWorkCategoryID').html('<option value="0" disabled selected style="display:none;">Выберите категорию</option>');
        $('#socialWorkID').html('<option value="0" disabled selected style="display:none;">Выберите общественную работу</option>');
        $('#socialCategoryID').html('<option value="0" disabled selected style="display:none;">Выберите социальную категорию</option>');
        $('#completeDocs').prop('checked', false);
        $('#socialGrant').prop('checked', false);
        $('#documents').val('');
        $('#comment').val('');
        $('#score').val('');
        $('#averageScore').val('');
        $('#moneyCategory').val('');

        //Если воле номера студенческого не заполнили, то выводим об этом сообщение с предупреждением и завершаем скрипт
        if ($('#studentID').val() == "") {
          alert ("Не введён номер студенческого.");
          return;
        }

        var query_data = sendInform("studentID");

        $.getJSON('/student', query_data, function(data) {
            $.each(data, function(index, el) {
              $("#educationalGroup").val(el.educationalGroup);
              $("#phone").val(el.phone);
              $("#bankAccountNumber").val(el.bankAccountNumber);
              $("#fio").val(el.name);
            });
        });

        //запрашиваем данные о разделах мероприятий и записываем их в элемент sectionID
        $.getJSON('/section', function(data) {
            $.each(data, function(index, el) {
              $('<option value="' + el.sectionID + '">' + el.title + '</option>').appendTo("#sectionID");
            });
        });

        //активация комбобокса раздела мероприятия и checkbox "Все документы в наличии"
        changeSettings("sectionID", "disabled", false, "completeDocs", "disabled", false);
      }
    </script> 


<!-- ____________________________________________________________________________________________________ -->


    <!-- Рассчитывание средней оценки студента и запись в value элемента c id=calculateButton -->
    <script>
	    function onClickСalculate() {
        //сли не было введено ни одно число - выводим об этом сообщение и прекращаем вычисление среднего значения
        if ($('#score').val() == '') {
          alert('Не введена ни одна оценка.');
        }
        else {
          $("#averageScore").val(averageEstimates("score"));

          //присваиваем вычисленное значение объекту addObject
          addObject["averageScore"] = $("#averageScore").val();
        }
	    }
    </script>


<!-- ____________________________________________________________________________________________________ -->


		<!-- Заполняем поле eventID мероприятиями по выбранному разделу мероприятий-->
		<script>
			function onChangeSection() {

        //выключаем все элементы при смене раздела (в дальнейшей работе с программой нужные элементы будут включены)
        changeSettings("socialGrant", 'disabled', true,
          "socialCategoryID", 'disabled', true,
          "socialWorkCategoryID", 'disabled', true,
          "socialWorkID", 'disabled', true,
          "score",'disabled', true,
          "calculateButton", 'disabled', true,
          "bankAccountNumber", 'disabled', true);

        //очищаем объект addObject
        addObject = {};

        //очищаем все поля ввода, чтобы пользователь случайно не добавил заявление с неверными данными
        $('#eventID').html('<option value="0" disabled selected style="display:none;">Выберите мероприятие</option>');
        $('#socialWorkCategoryID').html('<option value="0" disabled selected style="display:none;">Выберите категорию</option>');
        $('#socialWorkID').html('<option value="0" disabled selected style="display:none;">Выберите общественную работу</option>');
        $('#socialCategoryID').html('<option value="0" disabled selected style="display:none;">Выберите социальную категорию</option>');
        $('#completeDocs').prop('checked', false);
        $('#socialGrant').prop('checked', false);
        $('#documents').val('');
        $('#comment').val('');
        $('#score').val('');
        $('#averageScore').val('');
        $('#moneyCategory').val('');

        //Заполняем поле eventID мероприятиями по выбранному разделу мероприятий
        var query_data = sendInform("sectionID");

				$.getJSON('/event', query_data, function(data) {
						$.each(data, function(index, el) {
							 $('<option value="' + el.eventID + '">' + el.title + '</option>').appendTo('#eventID');
						});
				});

        //активация комбобокса мероприятий и раздела с комментарием
        changeSettings("eventID", "disabled", false, "comment", "disabled", false);

			}
		</script>


<!-- ____________________________________________________________________________________________________ -->


    <!-- при выборе мероприятия проверяем, не подавал ли студент заявление на него в этом семестре и не ездил ли на него вообще за всё время обучения,
         активируем кнопку добавления заявления -->
    <script>
        function onChangeEvent() {

          //активируем кнопку добавления заявления
          changeSettings("calculateButton", "disabled", true);

          //сбрасываем флаг попадания заявления в резерв
          reserve = false;

          var query_data = sendInform("studentID", "sectionID");

          //проверяем, подавал ли студент заявление по данному разделу в текущем семестре
          $.getJSON('/statement/check/beenOnSectionInCurTerm', query_data, function(data) {
            //если получили true - студент автматически попадает в резерв
            if (data == true) {
              reserve = true;
              alert('Студент уже подавал заявление по данному разделу. При подаче ещё одного заявления оно автоматически попадёт в резерв.');
            }
          });

          var query_data = sendInform("studentID", "eventID");

          //проверяем, подавал ли студент заявление на данное мероприятие в текущем семестре
          $.getJSON('/statement/check/madeStatementOnEvent', query_data, function(data) {

              //если нашлись заявления, удовлетворяющие условиям, блокируем добавление и сообщеам, что документы уже были добавлены
              if (data == true) {
                //деактивируем кнопку "Добавить""
                changeSettings("addButton", "disabled", true);

                //выводим сообщение о том, что студент уже подавал документы на данное мероприятие в текущем семестре
                alert('Нельзя принять документы. Студент уже подавал заявление на выбранное мероприятие в текущем семестре.');

                return;
              }
              //если заявлений, удовлетворяющих условиям нет, разблокируем кнопку "Добавить"
              else {
                changeSettings("addButton", "disabled", false);
              }
          });


          //проверяем, ездил ли студент на данное мероприятие за всё время обучения (по предкам мероприятия)
          $.getJSON('/statement/check/beenOnAncestors', query_data, function(data) {
            //если true, то предупреждаем, что заявление автоматически попадает в резерв
            if (data == true) {
              reserve = true;
              alert("Студент уже ездил на данное мероприятие раньше. Его заявление автоматически попадёт в резерв.");
            }
          });

          var query_data = sendInform("sectionID");

          //активирование нужных и деактивирование ненужных для выбранного раздела элементов, а так же заполнение активированных
          $.getJSON('/section', query_data, function(data) {
              $.each(data, function(index, el) {

                 changeSettings("socialGrant", "disabled", !el.socialGrant, 
                  "socialCategoryID", "disabled", !el.socialCategory,
                  "socialWorkCategoryID", "disabled", !el.socialWork,
                  "score", "disabled", !el.averageScore,
                  "calculateButton", "disabled", !el.averageScore,
                  "bankAccountNumber", "disabled", !el.bankAccountNumber);

                 //заполняем объект addObject элементами, нужными для выбранного раздела
                 //если нужна социальная категория
                 if (el.socialCategory) {
                    addObject["socialCategoryID"] = -1;
                 }
                 //если нужна социальная работа
                 if (el.socialWork) {
                    addObject["socialWorkCategoryID"] = -1;
                    addObject["socialWorkID"] = -1;
                 }
                 //если нужна средняя оценка за последний семестр
                 if (el.averageScore) {
                    addObject["averageScore"] = -1;
                 }

                 if (el.socialCategory) {
                    $.getJSON('/socialCategory', function(data) {
                      $.each(data, function(index, el) {
                         $('<option value="' + el.socialCategoryID + '">' + el.title + '</option>').appendTo('#socialCategoryID');
                      });
                    });
                 };

                 if (el.socialWork) {
                    $.getJSON('/socialWorkCategory', function(data) {
                        $.each(data, function(index, el) {
                           $('<option value="' + el.socialWorkCategoryID + '">' + el.title + '</option>').appendTo('#socialWorkCategoryID');
                        });
                    });
                 };

              });
          });
        }
    </script>


<!-- ____________________________________________________________________________________________________ -->


    <!-- заполнение комбобокса видами общественных работ в зависимости от выбранной категории общественных работ и активация этого комбобокса -->
    <script>
      function onChangeSocialWorkCategory() {

        //очищаем элемент от старых записей
        $('#socialWorkID').html('<option value="0" disabled selected style="display:none;">Выберите общественную работу</option>');
        
        var query_data = sendInform("socialWorkCategoryID");
        $.getJSON('/socialWork', query_data, function(data) {
            $.each(data, function(index, el) {
              $('<option value="' + el.socialWorkID + '">' + el.title + '</option>').appendTo('#socialWorkID');

              //присваиваем выбранное значение объекту addObject
              addObject["socialWorkCategoryID"] = query_data.socialWorkCategoryID;
            });
        });

        changeSettings("socialWorkID", "disabled", false);
      }
    </script>


<!-- ____________________________________________________________________________________________________ -->


<!-- при смене вида общественной работы сохраняем в объект addObject выбранный вариант -->
  <script>
    function onChangeSocialWork(){
      addObject["socialWorkID"] = $("#socialWorkID").val();
    }
  </script>


<!-- ____________________________________________________________________________________________________ -->


<!-- при выборе социальной категории заполняем окошко необходимых документов и выводим выплачиваемую денежную сумму, если она нужна -->
    <script>
      function onChangeSocialCategory(){

        //переменная для хранения выплачиваемой суммы денег
        var moneyCategory = 0;
        //заполняем окошко нербходимыми документами для данной социальной категории
        var query_data = sendInform("socialCategoryID");
        $.getJSON('/socialCategory', query_data, function(data) {
            $.each(data, function(index, el) {
              $("#documents").val(el.documents);
              moneyCategory = el.money;

              //присваиваем объекту addObject выбранное значение
              addObject["socialCategoryID"] = el.socialCategoryID;
            });
        });

        //если для выбранного раздела нужно знать выплачиваемую сумму денег, то заполняем это поле
        var query_data = sendInform("section");
        $.getJSON('/section', query_data, function(data) {
            $.each(data, function(index, el) {
              if (el.moneyCategory) {
                $("#moneyCategory").text(moneyCategory);
              };
            });
        });
      }
    </script>


<!-- ____________________________________________________________________________________________________ -->


    <!-- проверяем, какая клавиша была нажата. Если enter, то вызываем обработчик писка студента по номеру студенческого -->
    <script>
      $("#studentID").keyup(function (e){
        if (e.keyCode === 13) {
          onClickFind();
        }
        return false;
      });
    </script>


<!-- ____________________________________________________________________________________________________ -->


    <!-- проверяем правильность заполнения полей и отправляем данные на сервер для добавления заявления -->
    <script>
      function onClickAddButton(){

        // var data = {
        //   "studentID":$("#studentID").val(),
        //   "eventID":$("#eventID").val(),
        //   "socialCategoryID":$("#socialCategoryID").val(),
        //   "socialWorkID":$("#socialWorkID").val(),
        //   "completeDocs":$("#completeDocs").is(":checked"),
        //   "comment":$("#comment").val(),
        //   "reserve":reserve
        // };

        //проверяем, заполнены ли все необходимые поля
        for (var el in addObject){
          if (addObject[el] == -1) {
            alert("Заполнены не все необходимые поля.");
            return;
          }
        }

        var query_data = sendInform("studentID", "eventID", "socialCategoryID", "socialWorkID", "completeDocs", "comment", "averageScore");
        // поскольку reserve является глобальной переменной, а не элементом формы, то запичываем его в объект вручную
        query_data["reserve"] = reserve;

        var str = JSON.stringify(query_data);

        $.ajax({
          url: '/statement',
          type: 'POST',
          data: str,
          processData: false,
          contentType: "application/json",
          // делаем запрос синхронным
          async: false
        });

        //выводим сообщение пользователю о том, что заявление принято
        alert("Заявление принято.");

        //очищаем поля ввода для следующего заявления
        changeSettings("socialGrant", 'disabled', true,
          "socialCategoryID", 'disabled', true,
          "socialWorkCategoryID", 'disabled', true,
          "socialWorkID", 'disabled', true,
          "score",'disabled', true,
          "calculateButton", 'disabled', true,
          "bankAccountNumber", 'disabled', true,
          "eventID", "disabled", true,
          "comment", "disabled", true);

        $('#sectionID').html('<option value="0" disabled selected style="display:none;">Выберите раздел</option>');
        $('#eventID').html('<option value="0" disabled selected style="display:none;">Выберите мероприятие</option>');
        $('#socialWorkCategoryID').html('<option value="0" disabled selected style="display:none;">Выберите категорию</option>');
        $('#socialWorkID').html('<option value="0" disabled selected style="display:none;">Выберите общественную работу</option>');
        $('#socialCategoryID').html('<option value="0" disabled selected style="display:none;">Выберите социальную категорию</option>');
        $('#completeDocs').prop('checked', false);
        $('#socialGrant').prop('checked', false);
        $('#documents').val('');
        $('#comment').val('');
        $('#score').val('');
        $('#averageScore').val('');
        $('#moneyCategory').val('');
        $('#studentID').val('');
        $('#educationalGroup').val('');

        // переводим фокус ввода на элемент с номером студенческого
        $('#studentID').focus();

      }
    </script>


<!-- ____________________________________________________________________________________________________ -->


    <!-- при потере фокуса у элемента bankAccountNumber отправляем номер банковского счёта этого студента на сервер для записи -->
    <script>
      function onBlurBankAccountNumber(){

        //проверка на нужное количество символов в номере банковского счёта
        if ($("#bankAccountNumber").val().length != 20) {
          alert('Неверно введён номер банковского счёта (пропущена одна или несколько цифр).');
          return;
        };

        //формируем JSON объект для отправки на сервер
        var query_data = sendInform("studentID", "bankAccountNumber");

        // $.ajax({
        //   url: '/student/changeBankAccountNumber',
        //   type: 'POST',
        //   data: query_data
        // });

        $.post('/student/changeBankAccountNumber', query_data);

      }
    </script>

  
    <!-- Перенаправление не страницу с карточкой студента при нажатии кнопки "Открыть карточку студента" -->
    <script>
      function onClickOpenStudent() {

        window.location.href = "/statements.html?statementID=" + $('#studentID').val();

      }
    </script>


  </body>
</html>